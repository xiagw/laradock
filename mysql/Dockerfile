ARG MYSQL_VERSION=8.0
FROM mysql:${MYSQL_VERSION}

#####################################
# Set Timezone
#####################################
ARG TZ=UTC
ENV TZ=${TZ}

ARG MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}

# Replication configuration
## MYSQL_REPL_MODE=single: Single instance
## MYSQL_REPL_MODE=m2s: Master to Slave
## MYSQL_REPL_MODE=m2m: Master to Master
ARG MYSQL_REPL_MODE=single
ARG MYSQL_ROLE=slave
ARG MYSQL_MASTER_HOST=mysql1
ARG MYSQL_REPL_USER=repl
ARG MYSQL_REPL_PASSWORD=replpass

ENV MYSQL_REPL_MODE=${MYSQL_REPL_MODE}
ENV MYSQL_ROLE=${MYSQL_ROLE}
ENV MYSQL_MASTER_HOST=${MYSQL_MASTER_HOST}
ENV MYSQL_REPL_USER=${MYSQL_REPL_USER}
ENV MYSQL_REPL_PASSWORD=${MYSQL_REPL_PASSWORD}

EXPOSE 3306

COPY ./root/ /

RUN bash /opt/build.sh
