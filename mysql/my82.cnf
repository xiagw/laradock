[mysqld]
host_cache_size=0
explicit_defaults_for_timestamp
tls_version=TLSv1.2,TLSv1.3
character-set-server=utf8mb4
# lower_case_table_names = 1
myisam_recover_options = FORCE,BACKUP
max_allowed_packet = 128M
max_connect_errors = 1000000
skip-name-resolve

# Connection timeout settings
wait_timeout = 28800
interactive_timeout = 28800

# Performance settings
max_connections = 2048
open_files_limit = 65535
slow_query_log = 1
long_query_time = 1

sql-mode="STRICT_TRANS_TABLES,NO_ENGINE_SUBSTITUTION,NO_ZERO_DATE,NO_ZERO_IN_DATE,ERROR_FOR_DIVISION_BY_ZERO"

# Binary log settings
log_bin = log-bin
log_bin_index = log-bin
binlog_format = ROW
binlog_row_image = MINIMAL
sync_binlog = 1
max_binlog_size = 1024M
binlog_cache_size = 4M
binlog_checksum = NONE

# GTID settings
gtid_mode = ON
enforce_gtid_consistency = ON

# Common filters
binlog_ignore_db = mysql
binlog_ignore_db = test
binlog_ignore_db = information_schema
replicate_ignore_db = mysql
replicate_ignore_db = test
replicate_ignore_db = information_schema

# Relay log settings
relay_log = mysql-relay-bin
relay_log_index = mysql-relay-bin.index
relay_log_recovery = ON
relay_log_purge = 1
relay_log_space_limit = 0
sync_relay_log = 1

# MySQL 8.0 replication settings
log_replica_updates = ON
replica_preserve_commit_order = 1
replica_net_timeout = 60
## 30 days
binlog_expire_logs_seconds = 2592000

######## Master-Master replication (source 1)
server_id = 2
read_only = 0
auto_increment_offset = 2
auto_increment_increment = 2
